This page contains instructions for compiling and using SG⁺⁺ with
GCC or ICC under Mac OSX.
For brevity, we assume you want to compile with GCC;
the compiler can be changed easily, however.

# Dependencies

## Required
The following software is required in order to build SG⁺⁺:
- <a href="https://gcc.gnu.org/" target="_blank">GCC (&ge; 4.8)</a>
- <a href="http://www.scons.org/" target="_blank">SCons (&ge; 2.3)</a> is required for building (build system).
SCons is written in Python 2.7, which is therefore needed by SG⁺⁺ as well.

## Recommended
The following software is recommended for core functionality:
- <a href="http://www.boost.org/" target="_blank">Boost.Test</a> for compiling and running the unit tests.
You can also skip the unit tests, but this is not recommended.
- <a href="http://www.swig.org/" target="_blank">SWIG (&ge; 3.0.4)</a>, if you want to use SG⁺⁺ within Python, Java, or MATLAB.
SWIG creates bindings from C/C++ functions in order to make
them available as a Python module or
prepare them to be called from Java code.
- <a href="http://www.python.org/" target="_blank"> Python development headers</a> are needed,
if you want to compile the Python bindings.
- <a href="http://www.numpy.org/" target="_blank">NumPy for Python 2.7</a> is needed, if you want to run the Python tests/examples.
- <a href="http://www.java.com/" target="_blank">Java Development Kit (JDK)</a>, if you want to compile the Java bindings.
- <a href="http://www.doxygen.org/" target="_blank">Doxygen</a> is required to
create and compile the documentation, which you are reading right now.
It is also required to automatically annotate the Python bindings
generated by SWIG with docstrings.

## Optional
The following software can be installed for full functionality:
- <a href="http://www.graphviz.org/" target="_blank"> dot in the Graphviz package</a>
is optional and generates inheritance diagrams in the Doxygen documentation.
- <a href="http://www.mathworks.com/" target="_blank">MATLAB</a>,
if you want to use SG⁺⁺ within MATLAB.
- <a href="https://www.gnu.org/software/gsl/" target="_blank">GNU Scientific Library (GSL)</a>,
is required for some functionalities of the <tt>SG_DATADRIVEN</tt> module.
## Installation
For some of the above applications, binaries for Mac OSX are available.
Most packages would need to be installed by hand. To simplify this, package
management is recomended. We will relly on the commonly used on <a href="http://brew.sh/" target="_blank">Homebrew</a> for package management in the following .
In order for things to work propperly, you should keep to the order proposed below:
- Install the Java JDK from <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">the Oracle webpage </a>
- python 2.7 is already part of Mac OSX
- Install GCC ` brew install gcc `
- SCons: ` brew install scons `
- SWIG: ` brew install swig `
- Doxygen: ` brew install doxygen --with-graphviz `
- Dot: ` brew install graphviz `
- Dot: ` brew install gsl `
- NumPy: use the python package manager PIP ` pip install numpy `
- Boost: Here comes the tricky part. In order for boost to be compatible with C++11 headers, we have to compile the Boost package using GCC.
First ` export HOMEBREW_CC=gcc-5 ` and ` export HOMEBREW_CXX=g++-5 ` (may differ from which version your GCC actually is),
then install boost using ` brew install boost --c++11 `
- Add ` export JAVA_HOME="$(/usr/libexec/java_home -v 1.8)" ` in your <tt>~/.bash_profile</tt> If the Java headers (jni.h, for example) are located somewhere else on your system, export the following variable manually
`
export JNI_CPPINCLUDE=/System/Library/Frameworks/JavaVM.framework/Versions/Current/Headers
`
The path itself can vary on your system. Note that the version has to correspond to an installed version.
# Compilation with SCons
Apple has installed a prehistoric version of GCC on your Mac.
But it is there and it will cause you trouble, because scons thinks
this is the GCC you want to use. You need to tell it the correct paths.
Do so by appending
```console
CC=/usr/local/bin/gcc-5 CC=/usr/local/bin/g++-5
```
to EVERY SINGLE CALL of scons (again name of the executable may be different for newer versions).
Do this even when calling the help function. Else scons will complain it can't find any c++11 compilers.
Compilation of the C++ libraries is done with SCons. Execute
```console
scons -j <number of cores>
```
in the main folder to compile SG⁺⁺ with GCC.
For configuration (including other compilers) and
optimization, see below.
If SCons does not seem to find external dependencies
even if they are installed,
you might want to clear the SCons cache before trying again:
```console
rm -r .sconf_temp .sconsign.dblite
```
To obtain help on parameters for compilation, type
```console
scons --help
```
After compilation, all unit-tests
(located in the <tt>tests</tt>-folder of each module) are executed,
if Boost.Test is installed.
There are also some tests written in Python,
but the majority is written with Boost.Test.
When the build is finished,
the shared libraries are installed in <tt>lib/sgpp</tt>.
If you use it, add this directory to your <tt>DYLD_FALLBACK_LIBRARY_PATH</tt>.
Instructions are also displayed at the end of the build.

## Configuration
SCons uses the file <tt>SConstruct</tt>. This file contains all information for
compiling SGpp.
If you just execute <tt>scons</tt> (with CC and CXX specified as above) ,
the default compilation with GCC for SSE3 instruction set is selected.
The compiler can be changed using
<tt>COMPILER=intel</tt>, e.g.
To use other instruction sets, use <tt>ARCH=avx</tt>, etc.
You are able to compile different SG⁺⁺ modules independently.
However, you should take into account the dependencies between
the modules to avoid "undefined symbol" errors:
When using them, depending on the dependencies,
other modules might have to be included, too.
The currently available modules are (see the [modules page](https://github.com/SGpp/SGpp/wiki/Modules)):
- <tt>SG_BASE</tt>: basic functionality
- <tt>SG_DATADRIVEN</tt>: operations on data
- <tt>SG_SOLVER</tt>: classes for solving the systems of equations
- <tt>SG_PDE</tt>: partial differential equations
- <tt>SG_FINANCE</tt>: financial module
- <tt>SG_PARALLEL</tt>: classes for parallel computing
- <tt>SG_COMBIGRID</tt>: combigrid classes
- <tt>SG_OPTIMIZATION</tt>: optimization of objective functions
Also, there are two switches for supported high-level back-ends:
- <tt>SG_PYTHON</tt>: Python bindings
- <tt>SG_JAVA</tt>: Java bindings
For example, the command
```console
scons SG_OPTIMIZATION=0
```
will compile all modules except optimization.
Additionally, you can pass some specific flags to the compiler
using the <tt>CPPFLAGS</tt> environment variable:
```console
scons CPPFLAGS='-g -O0'
```
## Python Bindings
The Python bindings are important,
because some unit tests are written in Python.
By default, the Python bindings are built, too.
If not, then some prerequisites are missing
(see [Linux dependencies](https://github.com/SGpp/SGpp/wiki/Linux-(GCC-Clang-ICC))).
By default, the Python bindings will be annotated with Python docstrings,
if Doxygen is installed.
Disabling this feature, which is recommended if you have to recompile the whole codebase frequently, is done by setting <tt>PYDOC=0</tt> in the
SCons command line.
When the build is finished,
the Python bindings are installed in <tt>lib/pysgpp</tt>.
If you use them, add the <tt>lib</tt> directory to your <tt>PYTHONPATH</tt>.
Alternatively, you can install the bindings into your local
<tt>site-packages</tt> directory:
```console
python setup.py install --user
```
Instructions are also displayed at the end of the build.
In Python, you can import the library and print its contents via
```python
import pysgpp
dir(pysgpp)
```
## Java Bindings
By default, the Java bindings are built, too.
If not, then the JDK is missing
(see the [Linux dependencies](https://github.com/SGpp/SGpp/wiki/Linux-(GCC-Clang-ICC))).
<!--
## Eclipse and SCons
Create a Makefile project and change the project properties as follows:
- <i>Properties</i> &rarr; <i>C/C++ Build</i> &rarr; <i>Builder Settings</i>:
Disable <i>Use default build command</i> and set <i>Build command</i> to
<tt>scons</tt>.
- <i>Properties</i> &rarr; <i>C/C++ Build</i> &rarr; <i>Behaviour</i>:
Set <i>Build (Incremental build)</i> to, e.g., <tt>-j 2</tt>
and <i>Clean</i> to <tt>-c</tt>.
-->
# Using SG⁺⁺
In this section, we show how SG⁺⁺ can be used as a library in other programs.
For C++, this includes compilation, linking, and execution of the program
using SG⁺⁺.
We also show how to use SG⁺⁺ from the other supported languages
(Python, Java, and MATLAB).
As an example application, we consider the [base quick start example](https://github.com/SGpp/SGpp/wiki/Base-quick-start-(C%E2%81%BA%E2%81%BA)) tutorial.cpp;
however, the instructions can be analogously applied to other programs.
Note that all examples are automatically built
after each SCons run.
Therefore, the following steps are not necessary to compile the examples;
rather, the intent is to show the steps to build an application using SG⁺⁺.
In the following, the current directory is always <tt>base/examples</tt> and
`/PATH_TO_SGPP` refers to the absolute path of the SG⁺⁺ directory.
We assume that SG⁺⁺ or its bindings have been successfully built before.

## C++
First, compile the program
while supplying the include paths of the relevant modules:
```console
g++ tutorial.cpp \
-c -std=c++11 -fopenmp \
-I/PATH_TO_SGPP/base/src \
-o tutorial.o
```
Then, link the program by indicating the SG⁺⁺ library path and the modules
you want to link against:
```console
g++ tutorial.o \
-fopenmp \
-L/PATH_TO_SGPP/lib/sgpp \
-lsgppbase \
-o tutorial
```
To run the program, note that you have to set the `LD_LIBRARY_PATH`
environment variable to include the SG⁺⁺ library path:
```console
export DYLD_FALLBACK_LIBRARY_PATH ="/PATH_TO_SGPP/lib/sgpp:$DYLD_FALLBACK_LIBRARY_PATH "
./tutorial
```

## Python
The Python bindings pysgpp can be used either by setting the
`PYTHONPATH` environment variable to include the `lib` directory, i.e.
```console
export PYTHONPATH="/PATH_TO_SGPP/lib:$PYTHONPATH"
```
or by installing pysgpp in the local `site-packages` folder:
```console
python setup.py install --user
```
To run your Python program, don't forget to update the `DYLD_FALLBACK_LIBRARY_PATH`
environment variable in any case:
```console
export DYLD_FALLBACK_LIBRARY_PATH ="/PATH_TO_SGPP/lib/sgpp:$DYLD_FALLBACK_LIBRARY_PATH "
python tutorial.py
```
## Misc
Other options as specified in the [Linux instructions](https://github.com/SGpp/SGpp/wiki/Linux-(GCC-Clang-ICC)) may work in Mac OSX but have not been tested so far.
Share your success stories and issues with us to make this documentation more complete.

