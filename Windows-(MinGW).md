This page contains instructions for compiling and using SG⁺⁺ with
MinGW (64-bit) under Windows.

# Caveats
- Aligned memory allocation is buggy (leads to program crashes)
and therefore turned off in the MinGW build.
- Libraries compiled with different Windows compiler are in general not
compatible with each other.
So, using the compiled SG⁺⁺ library from MSVC++ won't work or
requires a large amount of work.
# Dependencies
## Required
The following software is required in order to build SG⁺⁺:
- <a href="http://mingw-w64.org/" target="_blank">MinGW-w64</a>,
which provides the compiler toolchain including `g++`
- <a href="http://python.org/" target="_blank">Python 2.7 (x64)</a>
as a prerequisite for SCons (Python 3.0 is not yet support by SCons).
If you do not plan to compile the Python bindings (pysgpp),
then the x86 version of Python is sufficient.
- <a href="http://sourceforge.net/projects/pywin32/" target="_blank"> PyWin32 (x64)</a> for parallel building and some tweaks in our `SConstruct`.
- <a href="http://www.scons.org/" target="_blank">SCons (&ge; 2.3)</a>
is required for building (build system).

## Recommended
The following software is recommended for core functionality:
- <a href="http://www.boost.org/" target="_blank">Boost.Test</a>
for compiling and running the unit tests.
You can also skip the unit tests, but this is not recommended.
- <a href="http://www.swig.org/" target="_blank">SWIG (&ge; 3.0.4)</a>,
if you want to use SG⁺⁺ within Python, Java, or MATLAB.
SWIG creates bindings from C/C++ functions in order to make
them available as a Python module or prepare them to be called from Java code.
- <a href="http://www.numpy.org/" target="_blank"> NumPy for Python 2.7 (x64)</a> is needed,
if you want to run the Python tests/examples.
- <a href="http://www.java.com/" target="_blank"> Java Development Kit (JDK, x64)</a>,
if you want to compile the Java bindings.
- <a href="http://www.doxygen.org/" target="_blank">Doxygen</a> is required to
create and compile the documentation, which you are reading right now.
It is also required to automatically annotate the Python bindings
generated by SWIG with docstrings.

## Optional
The following software can be installed for full functionality:
- <a href="http://www.graphviz.org/" target="_blank"> dot in the Graphviz package</a>
is optional and generates inheritance diagrams in the Doxygen documentation.
- <a href="http://www.mathworks.com/" target="_blank">MATLAB</a>,
if you want to use SG⁺⁺ within MATLAB.
- <a href="https://www.gnu.org/software/gsl/" target="_blank">Gnu Scientific Library (GSL)</a>,
is required for some functionalities of the SG_DATADRIVEN module.
# Installation
It is advisable to install the requirements in this order:
1. First, please make sure that you install all dependencies to paths that do not
contain any space (no <tt>Program Files</tt> or similar)
or you might get trouble, i.e.,
the paths <tt>C:\\PATH_TO_MINGW</tt> etc.,
where you install the software, should be free of spaces.
2. MinGW:
    * Download <tt>mingw-w64-install.exe</tt> from the <a href="http://sourceforge.net/projects/mingw-w64/" target="_blank"> MinGW-w64 SourceForge page</a>.
    * Run the installer and select version at least 6.3.0 and the architecture `x86_64`.
    * Prepend <tt>C:\\PATH_TO_MINGW\\bin</tt> to the <tt>PATH</tt>
environment variable.
3. Python:
    * Download <tt>python-2.7.11.amd64.msi</tt> or similar from the <a href="http://python.org/" target="_blank">Python page</a>. Python 3.x is incompatible with SCons and the x86 version will not work with pysgpp.
    * Run the installer.
    * Prepend <tt>C:\\PATH_TO_PYTHON</tt> and <tt>C:\\PATH_TO_PYTHON\\Scripts</tt> to the <tt>PATH</tt> environment variable (this can also be done by the installer).
4. PyWin32:
    * Download <tt>pywin32-219.win-amd64-py2.7.exe</tt> or similar from the <a href="http://sourceforge.net/projects/pywin32/" target="_blank"> PyWin32 SourceForge page</a> (selecting a version for amd64 and Python 2.7 is important).
    * Run the installer, selecting the Python version you installed earlier.
5. SCons:
    * Download <tt>scons-2.4.1-amd64-setup.exe</tt> or similar from the <a href="http://sourceforge.net/projects/scons/" target="_blank"> SCons SourceForge page</a> (selecting a version for amd64 is important).
    * Run the installer, selecting the Python version you installed earlier.
6. Boost.Test:
    * Download <tt>boost_1_63_0.7z</tt> or similar (but at least version 1.63) from the <a href="http://www.boost.org/" target="_blank">Boost page</a>.
    * Unpack the archive.
    * Run the following in <tt>cmd.exe</tt>:
```console
cd C:\PATH_TO_BOOST
bootstrap.bat gcc
b2 --with-test ^
toolset=gcc ^
variant=release ^
link=shared ^
threading=multi ^
runtime-link=shared
```
4. Copy 
<tt>C:\\PATH_TO_BOOST\\stage\\lib\\libboost_unit_test_framework-mgw52-mt-1_59.dll</tt>
or similar to
<tt>C:\\PATH_TO_BOOST\\stage\\lib\\libboost_unit_test_framework.dll</tt>.
5. Prepend <tt>C:\\PATH_TO_BOOST\\stage\\lib</tt> to the <tt>PATH</tt> environment variable.
7. SWIG:
    * Download <tt>swigwin-3.0.7.zip</tt> or similar from the <a href="http://www.swig.org/" target="_blank">SWIG page</a>. A special x64 version is not necessary.
    * Extract the archive.
    * Prepend <tt>C:\\PATH_TO_SWIG</tt> to the <tt>PATH</tt> environment variable.
8. NumPy:
    * Download <tt>numpy‑1.9.3+mkl‑cp27‑none‑win_amd64.whl</tt> or similar from <a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#numpy"target="_blank"> this third-party page</a> (selecting a version for amd64 is important).
    * Run <tt>pip install numpy‑1.9.3+mkl‑cp27‑none‑win_amd64.whl</tt> to install NumPy.
9. JDK:
    * Download <tt>jdk-8u66-windows-x64.exe</tt> or similar from the <a href="http://www.java.com/" target="_blank">Java page</a> (selecting a version for amd64 is important).
    * Run the installer.
    * Prepend <tt>C:\\PATH_TO_JDK\\bin</tt> to the <tt>PATH</tt> environment variable.
    * If SCons does not seem to find the JDK in the right place, try checking the <tt>JAVA_HOME</tt> environment variable (either set it to the right path, e.g., <tt>C:\\PATH_TO_JDK</tt> without <tt>bin</tt>, or unset it completely).
10. Doxygen:
    * Download <tt>doxygen-1.8.10-setup.exe</tt> or similar from the <a href="http://www.doxygen.org/" target="_blank">Doxygen page</a>.
    * Run the installer.
    * Prepend <tt>C:\\PATH_TO_DOXYGEN\\bin</tt> to the <tt>PATH</tt> environment variable.
11. Dot:
    * Download <tt>graphviz-2.38.msi</tt> or similar from the <a href="http://www.graphviz.org/" target="_blank">Graphviz page</a>.
    * Run the installer.
    * Prepend <tt>C:\\PATH_TO_GRAPHVIZ\\bin</tt> to the <tt>PATH</tt> environment variable.
12. MATLAB:
    * Install MATLAB with the installer.
    * Prepend <tt>C:\\PATH_TO_MATLAB\\bin</tt> to the <tt>PATH</tt> environment variable.
13. GSL:
    * Download <tt>gsl-1.15-x64.7z</tt> from the <a href="https://sourceforge.net/projects/mingw-w64/files/External%20binary%20packages%20%28Win64%20hosted%29/Binaries%20%2864-bit%29/" target="_blank">MinGW-w64 SourceForge page</a>.
    * Extract the archive.
    * Copy <tt>C:\\PATH_TO_GSL\\bin\\libgsl-0.dll</tt> to <tt>C:\\PATH_TO_GSL\\bin\\libgsl.dll</tt> and
	  <tt>C:\\PATH_TO_GSL\\bin\\libgslcblas-0.dll</tt> to <tt>C:\\PATH_TO_GSL\\bin\\libgslcblas.dll</tt>.
    * Prepend <tt>C:\\PATH_TO_GSL\\bin</tt> to the <tt>PATH</tt> environment variable.

# Compilation with SCons
Before you compile with SCons you need to make sure that command line finds the executable. It is located in <tt><python 2 installation path>/Scripts</tt>. Add it either to your <tt>PATH</tt> variable or provide the full path when calling SCons. Furthermore, when compiling with SCons, supply <tt>COMPILER=gnu</tt> to override the default of MSVC++. Don't forget to add the locations of the Boost include and library path.
```console
scons.bat -j 4 ^
COMPILER=gnu ^
BOOST_INCLUDE_PATH=C:\PATH_TO_BOOST ^
BOOST_LIBRARY_PATH=C:\PATH_TO_BOOST\stage\lib
```
For additional remarks about building with SCons,
please refer to the [Linux page](https://github.com/SGpp/SGpp/wiki/Linux-(GCC-Clang-ICC)).

# Using SG⁺⁺
In this section, we show how SG⁺⁺ can be used as a library in other programs.
For C++, this includes compilation, linking, and execution of the program
using SG⁺⁺.
We also show how to use SG⁺⁺ from the other supported languages
(Python, Java, and MATLAB).
As an example application, we consider the [base quick start example](https://github.com/SGpp/SGpp/wiki/Base-quick-start-(C%E2%81%BA%E2%81%BA)) tutorial.cpp;
however, the instructions can be analogously applied to other programs.
Note that all examples are automatically built
after each SCons run.
Therefore, the following steps are not necessary to compile the examples;
rather, the intent is to show the steps to build an application using SG⁺⁺.
In the following, the current directory is always <tt>base\\examples</tt> and
<tt>C:\\PATH_TO_SGPP</tt> refers to the absolute path of the SG⁺⁺ directory.
We assume that SG⁺⁺ or its bindings have been successfully built before.

## C++
First, compile the program
while supplying the include paths of the relevant modules:
```console
g++ tutorial.cpp ^
-c -std=c++11 -fopenmp ^
-IC:\PATH_TO_SGPP\base\src ^
-o tutorial.o
```
Then, link the program by indicating the SG⁺⁺ library path and the modules
you want to link against:
```console
g++ tutorial.o -fopenmp ^
-LC:\PATH_TO_SGPP\lib\sgpp ^
-lsgppbase ^
-o tutorial
```
To run the program, note that you have to set the <tt>PATH</tt>
environment variable to include the SG⁺⁺ library path:
```console
set PATH=C:\PATH_TO_SGPP\lib\sgpp;%PATH%
tutorial
```
## Python
The Python bindings pysgpp can be used by installing pysgpp in the local `site-packages folder`:
```console
python setup.py install --user
```
To run your Python program, don't forget to update the `PATH`
environment variable in any case:
```console
set PATH=C:\PATH_TO_SGPP\lib\sgpp;%PATH%
python tutorial.py
```
## Java
Java programs using the Java bindings jsgpp have to be compiled in this way:
```console
javac -cp .;C:\PATH_TO_SGPP\lib\jsgpp\jsgpp.jar tutorial.java
```
Note the use of <tt>;</tt> instead of <tt>:</tt> like on Linux.
When running Java programs, you have to augment `PATH`
not only by the SG⁺⁺ library path, but also by a path specific for jsgpp:
```console
set PATH=C:\PATH_TO_SGPP\lib\sgpp:C:\PATH_TO_SGPP\lib\jsgpp:%PATH%
java -cp .;C:\PATH_TO_SGPP\lib\jsgpp\jsgpp.jar tutorial
```
## MATLAB
MATLAB can use SG⁺⁺ in three ways.
### Via Binaries
The recommended way is to download the binaries for use with MATLAB that are part of the SGpp [releases ](https://github.com/SGpp/SGpp/releases)
For instructions, please see the [matlab page](https://github.com/SGpp/SGpp/wiki/MATLAB-binaries).

### Via MEX Interface
If the binaries don't work for you, then it is possible to write and
compile a MEX interface yourself (similar to the interface that the
binaries would provide).
This means that you have to write a C++ program interacting
with SG⁺⁺ directly in C++ and converting input and output arguments
from and to MATLAB's data structures.
If
<a href="https://www.mathworks.com/help/matlab/ref/mex.html" target="_blank">
MATLAB's `mex` function</a> cannot find MinGW's <tt>g++</tt> compiler,
you can compile and link the MEX file by yourself with the following commands:
```console
g++ your_mex_program.cpp ^
-c -std=c++11 -fopenmp ^
-Wall -Wextra ^
-IC:\local\matlab_x64\R2015a\extern\include ^
-IC:\SGpp\trunk\base\src ^
-o your_mex_program.o && ^
g++ your_mex_program.o ^
-shared -fopenmp ^
-LC:\local\matlab_x64\R2015a\bin\win64 ^
-LC:\SGpp\trunk\lib\sgpp ^
-lmex ^
-lsgppbase ^
-o your_mex_program.mexw64
```
Of course, you have to add include paths and library switches for each
module that `your_mex_program` uses.
However, keep in mind that library files generated by different compilers
are not compatible with each other:
Refer to
<a href="https://www.mathworks.com/help/matlab/matlab_external/compiling-c-mex-files-with-mingw.html" target="_blank">
MATLAB's documentation page for troubleshooting with MinGW</a>
for more information.
### Via jsgpp
However, the more direct way to use SG⁺⁺ from within MATLAB is to use jsgpp,
i.e., using the Java library of SG⁺⁺ and import it to MATLAB.
Before we can use these methods in MATLAB, we have to add
<tt>C:\\PATH_TO_SGPP\\lib\\jsgpp</tt> to the `librarypath.txt` file of MATLAB.
(Hint: Typing `matlabroot` in MATLAB returns the path of your MATLAB
installation.)
Open the file <tt>C:\\PATH_TO_MATLAB\\toolbox\\local\\librarypath.txt</tt>
in a text editor and add the line
```console
C:\PATH_TO_SGPP\lib\jsgpp
```
at the end of the file.
When starting MATLAB, make sure that the Java version of
MATLAB's internal Java Runtime Environment
(check with <tt>version -java</tt> in MATLAB)
is newer than that of the Java you built jsgpp with
(check with <tt>java -version</tt> in <tt>cmd.exe</tt>).
In general, you will have to force MATLAB to use your installed JDK
by using the <tt>MATLAB_JAVA</tt> environment variable.
You can get errors like this otherwise:
```console
Undefined variable "sgpp" or class "sgpp.LoadJSGPPLib.loadJSGPPLib".
```
Keep in mind that, however, MATLAB seems not to be compatible with Java 8 yet.
Also, set the <tt>PATH</tt> environment variable appropriately as before.
Therefore, start MATLAB by typing the following:
```console
set MATLAB_JAVA=C:\PATH_TO_JDK\jre
set PATH=C:\PATH_TO_SGPP\lib\sgpp:C:\PATH_TO_SGPP\lib\jsgpp:%PATH%
matlab
```
After starting MATLAB,
we have to add the `jsgpp.jar` file to MATLAB's class path with the command
```console
javaaddpath('C:\PATH_TO_SGPP\lib\jsgpp\jsgpp.jar');
```
The final step consists in loading the jsgpp library via
```console
sgpp.LoadJSGPPLib.loadJSGPPLib();
```
You should now be able to use SG⁺⁺ in MATLAB.
For an example, look at <tt>base/examples/tutorial.m</tt>.
However, note that the example was written for the MATLAB SG⁺⁺ binaries
explained above.
Therefore, you likely have to change some calls especially to static
methods like <tt>sgpp.createOperationEval</tt>, which are now located
at <tt>sgpp.jsgpp.*</tt>.
### Hints
See the [Linux page](https://github.com/SGpp/SGpp/wiki/Linux-(GCC-Clang-ICC)) for hints on how to
use SG⁺⁺ within MATLAB.
# Troubleshooting
- In <tt>cmd.exe</tt>, type
```console
set
```
to display the values of all environment variables.
- If you get an error of this type during compilation
```console
OperationMultipleEvalSubspaceCombined.hpp:82:121: fatal error: ../../OperationMultipleEvalSubspace/combined/OperationMultipleEvalSubspaceCombined_calculateIndexCombined.hpp: No such file or directory
```
then a developer didn't read the [developer How-Tos](http://sgpp.sparsegrids.org/development.html#development_coding)
and did not know that relative include paths are not supported under Windows using MinGW.
You can fix this issue by yourself.
Please report this bug to the developers. Thanks!
- If you are using an older computer (say < 2011) and the compilation seem to succeed but the unit tests fail, then you might have a problem with your architecture. By default SG⁺⁺ is compiled with AVX support, which your processor may not support. Try to add the flag
```console
ARCH=SSE3
```
to your build command, which replaces AVX by SSE3. SSE3 is supported by processors, which have been released after 2006.



